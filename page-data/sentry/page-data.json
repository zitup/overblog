{"componentChunkName":"component---src-templates-blog-post-js","path":"/sentry/","result":{"data":{"site":{"siteMetadata":{"title":"Overblog","author":"zit"}},"markdownRemark":{"id":"bbc9ac06-ba9c-544c-a6a1-db7f1221322c","html":"<blockquote>\n<p>关键词： sentry docker 更换源</p>\n</blockquote>\n<h2 id=\"1-克隆-sentry-官方部署仓库\"><a href=\"#1-%E5%85%8B%E9%9A%86-sentry-%E5%AE%98%E6%96%B9%E9%83%A8%E7%BD%B2%E4%BB%93%E5%BA%93\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 克隆 sentry 官方部署仓库</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/getsentry/onpremise</code></pre></div>\n<h2 id=\"2-安装-docker-docker-compose\"><a href=\"#2-%E5%AE%89%E8%A3%85-docker-docker-compose\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 安装 docker docker-compose</h2>\n<h3 id=\"版本要求\"><a href=\"#%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>版本要求</strong></h3>\n<ul>\n<li>Docker 17.05.0+</li>\n<li>Compose 1.23.0+</li>\n</ul>\n<blockquote>\n<p>Ubuntu16-18 安装</p>\n</blockquote>\n<h3 id=\"安装-docker\"><a href=\"#%E5%AE%89%E8%A3%85-docker\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>安装 docker</strong></h3>\n<ul>\n<li>\n<p>删除旧版本 Docker</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt-get remove docker docker-engine docker.io</code></pre></div>\n</li>\n<li>\n<p>添加 Docker 软件源</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> apt-transport-https ca-certificates  <span class=\"token function\">curl</span> software-properties-common\n<span class=\"token function\">curl</span> -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -\n<span class=\"token function\">sudo</span> add-apt-repository <span class=\"token string\">\"deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu <span class=\"token variable\"><span class=\"token variable\">$(</span>lsb_release -cs<span class=\"token variable\">)</span></span> stable\"</span></code></pre></div>\n</li>\n<li>\n<p>安装 Docker CE（社区版）</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update -y\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> docker-ce -y</code></pre></div>\n</li>\n<li>\n<p>设置开机启动</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> docker\n<span class=\"token function\">sudo</span> systemctl start docker</code></pre></div>\n</li>\n<li>\n<p>把当前用户加入 docker 组</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">groupadd</span> docker\n<span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> -aG docker <span class=\"token environment constant\">$USER</span></code></pre></div>\n</li>\n<li>\n<p>测试</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker run hello-world</code></pre></div>\n<h3 id=\"安装-docker-compose\"><a href=\"#%E5%AE%89%E8%A3%85-docker-compose\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>安装 docker-compose</strong></h3>\n</li>\n<li>\n<p>安装</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">curl</span> -L https://github.com/docker/compose/releases/download/1.18.0/docker-compose-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> -s<span class=\"token variable\">`</span></span>-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> -m<span class=\"token variable\">`</span></span> -o /usr/local/bin/docker-compose\n<span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose</code></pre></div>\n</li>\n<li>\n<p>测试</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  docker-compose --version</code></pre></div>\n</li>\n</ul>\n<blockquote>\n<p>mac 安装  </p>\n</blockquote>\n<p>  直接官网下载安装，<a href=\"https://docs.docker.com/docker-for-mac/install/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">地址点我</a>，国内下载较慢，可以使用迅雷下载（迅雷用完就删😼），Docker for Mac 和 Docker Toolbox 已经包含了 Compose , 所以 Mac 用户不用单独安装Compose</p>\n<h2 id=\"3-最重要的一步：更换源\"><a href=\"#3-%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%9B%B4%E6%8D%A2%E6%BA%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 最重要的一步：更换源</h2>\n<p>这里主要更换两处源</p>\n<ul>\n<li>\n<p>更换 docker 镜像源</p>\n<div class=\"gatsby-highlight\" data-language=\"jsxon\"><pre class=\"language-jsxon\"><code class=\"language-jsxon\">&quot;registry-mirrors&quot;: [\n  &quot;https://xxxxxx.mirror.aliyuncs.com&quot;,\n  &quot;http://docker.mirrors.ustc.edu.cn&quot;,\n  &quot;http://hub-mirror.c.163.com&quot;\n]</code></pre></div>\n</li>\n<li>\n<p><strong>更换 apt-get 源(重要！！！)</strong><br>\n这里是修改镜像中 apt debian 的源，否则国内下载要很久很久  </p>\n<ul>\n<li>进到第一步克隆的 onpremise 目录</li>\n<li>打开 cron 下的 Dockerfile</li>\n<li>\n<p>将</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">RUN <span class=\"token function\">apt-get</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> -y --no-install-recommends <span class=\"token function\">cron</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token function\">rm</span> -r /var/lib/apt/lists/*</code></pre></div>\n<p>替换成</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">RUN <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s@http://deb.debian.org@http://mirrors.aliyun.com@g\"</span> /etc/apt/sources.list\nRUN <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s@http://security.debian.org/debian-security@http://mirrors.aliyun.com/debian-security@g\"</span> /etc/apt/sources.list <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">rm</span> -Rf /var/lib/apt/lists/*\n\nRUN <span class=\"token function\">apt-get</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> -y --no-install-recommends <span class=\"token function\">cron</span> apt-utils <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token function\">rm</span> -r /var/lib/apt/lists/*</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-最后\"><a href=\"#4-%E6%9C%80%E5%90%8E\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 最后</h2>\n<ul>\n<li>onpremise 目录下 <code class=\"language-text\">./install.sh</code></li>\n<li>\n<p>启动</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose up -d</code></pre></div>\n</li>\n<li>\n<p>停止</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose stop</code></pre></div>\n</li>\n</ul>\n<p>结束，完美。</p>","timeToRead":3,"frontmatter":{"title":"sentry 部署极简教程","date":"August 31, 2020","spoiler":"docker 一键部署","cta":"react"},"fields":{"slug":"/sentry/","langKey":"en"}}},"pageContext":{"slug":"/sentry/","previous":{"fields":{"slug":"/react-15-to-16/","langKey":"en","directoryName":"react-15-to-16"},"frontmatter":{"title":"react 15.4.2 到 16.13.1 升级过程"}},"next":{"fields":{"slug":"/search-in-terminal/","langKey":"en","directoryName":"search-in-terminal"},"frontmatter":{"title":"在命令行使用谷歌搜索"}},"translations":[],"translatedLinks":[]}},"staticQueryHashes":["708209134"]}