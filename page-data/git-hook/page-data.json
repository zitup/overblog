{"componentChunkName":"component---src-templates-blog-post-js","path":"/git-hook/","result":{"data":{"site":{"siteMetadata":{"title":"Overblog","author":"zit"}},"markdownRemark":{"id":"8476dab6-6886-5c1b-b288-fe2c212e75f9","html":"<h3 id=\"ä»‹ç»-git-hook\"><a href=\"#%E4%BB%8B%E7%BB%8D-git-hook\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ä»‹ç» Git Hook</h3>\n<p><code class=\"language-text\">Git Hook</code> æ˜¯ Git æ‰§è¡Œå‘½ä»¤æ—¶å‰åå¯ä»¥è§¦å‘çš„çš„è„šæœ¬ï¼Œæ¯”å¦‚ pre-commit ï¼Œåœ¨æäº¤å‰æ‰§è¡ŒæŸäº›ä¸œè¥¿ï¼Œè¿™ä¸ªä¹Ÿæ˜¯åœ¨å‰ç«¯ä½“ç³»ä¸­ç”¨çš„è¾ƒå¤šçš„ä¸€ä¸ª Hookï¼Œå¸¸è§çš„ä½¿ç”¨ä¸€èˆ¬ä¹Ÿæ˜¯æ­é… Husky å’Œ lint-staged ï¼Œåšä»£ç æäº¤å‰çš„æ£€æŸ¥ã€‚è¿˜æœ‰å…¶ä»–çš„æ¯”å¦‚ï¼Œpre-rebase ã€ post-rewrite ã€post-checkout ã€post-merge ï¼Œçœ‹åå­—å°±çŸ¥é“ä»–ä»¬çš„æ‰§è¡Œæ—¶é—´äº†ã€‚</p>\n<h3 id=\"æ€ä¹ˆå¿«é€Ÿåˆ›å»ºè‡ªå·±çš„é’©å­ï¼Ÿ\"><a href=\"#%E6%80%8E%E4%B9%88%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E9%92%A9%E5%AD%90%EF%BC%9F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æ€ä¹ˆå¿«é€Ÿåˆ›å»ºè‡ªå·±çš„é’©å­ï¼Ÿ</h3>\n<ol>\n<li>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸ºå¯¹åº”çš„é’©å­åç§°ï¼Œè¯­è¨€éšä¾¿ï¼Œè¿™é‡Œç”¨çš„nodejs</li>\n<li>å°†æ–‡ä»¶æ”¾åˆ°é¡¹ç›®ä¸‹çš„ .git/hooks</li>\n<li>chmod 777 xxx(ä½ çš„æ–‡ä»¶) ï¼Œå°†æ–‡ä»¶æ”¹ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</li>\n</ol>\n<p>ä½¿ç”¨å¯¹åº”çš„ git å‘½ä»¤ï¼Œé’©å­å°±ç”Ÿæ•ˆå•¦</p>\n<h3 id=\"æœ¬æ–‡ä¸»è§’--pre-commit\"><a href=\"#%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A7%92--pre-commit\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æœ¬æ–‡ä¸»è§’ ğŸ‘‰ pre-commit</h3>\n<p>ç›´æ¥ä¸Šä»£ç </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">#<span class=\"token operator\">!</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>env node\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> execSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'child_process'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// å®¢æˆ·ç«¯æ–‡ä»¶å¤¹åç§°</span>\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token string\">'client-src'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> stagedFile <span class=\"token operator\">=</span> <span class=\"token function\">execSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'git diff --cached --name-only'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>encoding<span class=\"token operator\">:</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token comment\">// æäº¤æ–‡ä»¶åŒ…å« client ä¸‹æ–‡ä»¶ï¼Œä¸åŒ…å« views/index.html</span>\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>stagedFile<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>stagedFile<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token function\">execSync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">cd </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>client<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> &amp;&amp; npm run build</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n   process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä»£ç çš„ç›®çš„æ˜¯å½“ staged çš„æ–‡ä»¶ä¸­åŒ…å« client ä¸‹çš„æ–‡ä»¶æ—¶ï¼Œåœ¨ client ä¸‹æ‰§è¡Œ buildï¼Œè·Ÿæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„æœ‰å…³ã€‚\n<code class=\"language-text\">git diff --cached --name-only</code> æ˜¯è·å– stage çš„æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®æ¡ä»¶æ¥æ‰§è¡ŒæŸäº›é€»è¾‘ã€‚\nprocess.exit(0) æ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œ commitï¼Œ0 ä¹‹å¤–çš„è¿”å›ï¼Œä¼šæ‰“æ–­ commit ã€‚</p>\n<p>So easy? å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œç„¶é¹…ä¸å¾—ä¸è¯´ git æ˜¯ä¸ªå¾ˆåºå¤§çš„æŠ€æœ¯æ ˆï¼Œæ•°ä¸æ¸…çš„å‘½ä»¤â€¦</p>\n<p>å¿«å»è¯•è¯•ä½ è‡ªå·±çš„é’©å­å§ï½ä¸è¦å¿˜äº† chmod 777 èµ‹äºˆæ–‡ä»¶å¯æ‰§è¡Œæƒé™å“Ÿï½</p>","timeToRead":2,"frontmatter":{"title":"æ€ä¹ˆç”¨ nodejs å†™ä¸€ä¸ª Git Hook","date":"December 27, 2020","spoiler":"Git Hook","cta":"git"},"fields":{"slug":"/git-hook/","langKey":"en"}}},"pageContext":{"slug":"/git-hook/","previous":{"fields":{"slug":"/react-useEffect/","langKey":"en","directoryName":"react-useEffect"},"frontmatter":{"title":"react - useEffect å°è®°"}},"next":null,"translations":[],"translatedLinks":[]}},"staticQueryHashes":["708209134"]}